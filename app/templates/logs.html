{% extends "base.html" %}

{% block title %}Logs - Shark-no-Ninsho-Mon{% endblock %}

{% block extra_css %}
<style>
.logs-container {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    max-height: 60vh;
    overflow-y: auto;
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.4;
}

.log-entry {
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.02);
    border-left: 3px solid rgba(255, 255, 255, 0.1);
}

.log-entry.info {
    border-left-color: #4299e1;
}

.log-entry.error {
    border-left-color: #f56565;
    background: rgba(245, 101, 101, 0.1);
}

.log-entry.warning {
    border-left-color: #ed8936;
    background: rgba(237, 137, 54, 0.1);
}

.log-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    align-items: center;
}

.log-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(66, 153, 225, 0.1);
    border: 1px solid rgba(66, 153, 225, 0.3);
    border-radius: 8px;
    font-size: 0.9rem;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4299e1;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.loading {
    text-align: center;
    padding: 2rem;
    color: rgba(255, 255, 255, 0.6);
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <h1>Application Logs</h1>
        <p class="subtitle">Viewing logs for: <strong>{{ email }}</strong></p>
        
        <div class="log-controls">
            <button class="btn btn-primary" onclick="refreshLogs()">
                <img src="{{ url_for('static', filename='icons/refresh.svg') }}" alt="" style="width: 16px; height: 16px; margin-right: 0.5rem;" aria-hidden="true">
                Refresh Logs
            </button>
            <button class="btn btn-secondary" onclick="clearLogs()">
                <img src="{{ url_for('static', filename='icons/delete.svg') }}" alt="" style="width: 16px; height: 16px; margin-right: 0.5rem;" aria-hidden="true">
                Clear Display
            </button>
            <div class="log-status">
                <span class="status-dot"></span>
                <span id="log-status">Loading...</span>
            </div>
        </div>
        
        <div class="logs-container" id="logs-container">
            <div class="loading">Loading logs...</div>
        </div>
    </div>
</div>

<script>
let autoRefresh = false;
let refreshInterval;

function refreshLogs() {
    fetch('/api/logs')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('logs-container');
            const status = document.getElementById('log-status');
            
            if (data.logs && data.logs.length > 0) {
                container.innerHTML = data.logs.map(log => {
                    let logClass = 'info';
                    if (log.includes('ERROR') || log.includes('error')) {
                        logClass = 'error';
                    } else if (log.includes('WARNING') || log.includes('warning')) {
                        logClass = 'warning';
                    }
                    
                    return `<div class="log-entry ${logClass}">${log}</div>`;
                }).join('');
                
                status.textContent = `${data.count} log entries - Last updated: ${new Date(data.timestamp).toLocaleTimeString()}`;
                
                // Auto-scroll to bottom
                container.scrollTop = container.scrollHeight;
            } else {
                container.innerHTML = '<div class="loading">No logs available</div>';
                status.textContent = 'No logs found';
            }
        })
        .catch(error => {
            console.error('Error fetching logs:', error);
            document.getElementById('logs-container').innerHTML = '<div class="log-entry error">Error fetching logs: ' + error.message + '</div>';
            document.getElementById('log-status').textContent = 'Error loading logs';
        });
}

function clearLogs() {
    document.getElementById('logs-container').innerHTML = '<div class="loading">Logs cleared</div>';
    document.getElementById('log-status').textContent = 'Display cleared';
}

function toggleAutoRefresh() {
    autoRefresh = !autoRefresh;
    
    if (autoRefresh) {
        refreshInterval = setInterval(refreshLogs, 5000); // Refresh every 5 seconds
        document.getElementById('log-status').textContent = 'Auto-refresh enabled';
    } else {
        clearInterval(refreshInterval);
        document.getElementById('log-status').textContent = 'Auto-refresh disabled';
    }
}

// Load logs on page load
document.addEventListener('DOMContentLoaded', function() {
    refreshLogs();
});
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}Dashboard - Shark-no-Ninsho-Mon{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Card -->
    <div class="welcome-card">
        <h1>Welcome back, <span class="user-email">{{ email }}</span></h1>
        <p class="subtitle">You are successfully authenticated and authorized</p>
    </div>

    <!-- Services Section -->
    <div class="card">
        <div class="card-header">
            <h2>Your Available Services</h2>
            <a href="/admin" class="btn btn-primary">
                Manage Routes
            </a>
        </div>
        
        <div id="services-grid" class="services-grid">
            {% if routes %}
                {% for route in routes %}
                <div class="service-card {% if not route.enabled %}service-disabled{% endif %}" data-status="{{ route.status }}">
                    {% if route.enabled %}
                        <a href="{{ route.path }}" class="service-link">
                    {% else %}
                        <a href="/route-disabled?path={{ route.path|urlencode }}&name={{ route.name|urlencode }}" class="service-link">
                    {% endif %}
                        <div class="service-icon">
                            {% if route.enabled %}
                                <img src="{{ url_for('static', filename='icons/arrow_outward.svg') }}" alt="" aria-hidden="true" style="width: 40px; height: 40px;">
                            {% else %}
                                <img src="{{ url_for('static', filename='icons/block.svg') }}" alt="" aria-hidden="true" style="width: 40px; height: 40px;">
                            {% endif %}
                        </div>
                        <div class="service-info">
                            <h3 class="service-title">{{ route.name }}{% if not route.enabled %} <small>(Disabled)</small>{% endif %}</h3>
                            <p class="service-path">{{ route.path }}</p>
                            <p class="service-target">{{ route.target_ip }}:{{ route.target_port }}</p>
                        </div>
                        <div class="service-status {% if not route.enabled %}disabled{% elif route.get('state') == 'UP' %}online{% elif route.get('state') == 'DEGRADED' %}slow{% elif route.get('state') == 'DOWN' %}offline{% elif route.status == 'online' %}online{% elif route.status == 'slow' %}slow{% elif route.status == 'offline' %}offline{% else %}offline{% endif %}">
                            <span class="status-dot"></span>
                            {% if not route.enabled %}
                                Disabled
                            {% elif route.get('state') == 'UP' %}
                                {% if route.get('reason') == 'online' %}
                                    Online{% if route.get('http_status') %} ({{ route.http_status }}){% endif %}
                                {% else %}
                                    {{ route.get('reason', 'Online').title() }}
                                {% endif %}
                            {% elif route.get('state') == 'DEGRADED' %}
                                {% if route.get('reason') == 'slow' %}
                                    Slow{% if route.get('duration_ms') %} ({{ (route.duration_ms / 1000)|round(1) }}s){% endif %}
                                {% else %}
                                    {{ route.get('reason', 'Degraded').title() }}
                                {% endif %}
                            {% elif route.get('state') == 'DOWN' %}
                                {% if route.get('reason') == 'offline_dns' %}
                                    DOWN — DNS
                                {% elif route.get('reason') == 'offline_conn' %}
                                    DOWN — Connect
                                {% elif route.get('reason') == 'timeout' %}
                                    DOWN — Timeout
                                {% elif route.get('reason') == 'error_5xx' %}
                                    DOWN — 5xx{% if route.get('http_status') %} ({{ route.http_status }}){% endif %}
                                {% elif route.get('reason') == 'error_exc' %}
                                    DOWN — Error
                                {% elif route.get('reason') == 'misconfig' %}
                                    DOWN — Config
                                {% else %}
                                    Offline
                                {% endif %}
                            {% elif route.status == 'online' %}
                                Online
                            {% elif route.status == 'slow' %}
                                Slow
                            {% elif route.status == 'offline' %}
                                Offline
                            {% else %}
                                Unknown
                            {% endif %}
                        </div>
                    </a>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">None</div>
                    <h3>No services configured yet</h3>
                    <p>Click "Manage Routes" to add your first service</p>
                    <a href="/admin" class="btn btn-primary">Get Started</a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Links -->
    <div class="card">
        <h2>Quick Links</h2>
        <div class="quick-links">
            <a href="/emails" class="quick-link">
                <span class="link-icon">
                    <img src="{{ url_for('static', filename='icons/account_circle.svg') }}" alt="" aria-hidden="true">
                </span>
                <span class="link-text">Email Management</span>
            </a>
            <a href="/logs" class="quick-link">
                <span class="link-icon">
                    <img src="{{ url_for('static', filename='icons/article.svg') }}" alt="" aria-hidden="true">
                </span>
                <span class="link-text">Application Logs</span>
            </a>
            <a href="/health" class="quick-link">
                <span class="link-icon">
                    <img src="{{ url_for('static', filename='icons/monitor_heart.svg') }}" alt="" aria-hidden="true">
                </span>
                <span class="link-text">Health Check</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}
